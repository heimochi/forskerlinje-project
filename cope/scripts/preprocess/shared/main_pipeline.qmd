
---
title: "Preprocessing Pipeline"
format: html
execute:
  echo: true
---

```{r setup}
# Load functions
source("cope/scripts/preprocess/shared/utilities.r")
```

```{r}
source("cope/scripts/preprocess/atq/00_load_data.r")

# Set working data
data <- ATQ
# Clean using shared function
data <- clean_clinical_data(data)

source("cope/scripts/preprocess/shared/01_filter.r")
source("cope/scripts/preprocess/shared/02_handle_missing.r")

source("cope/scripts/preprocess/atq/03_score_atq.r")

write.csv(data, "outputs/atq_f.csv", row.names = FALSE)

```

?? wrap each questionnaire in a function for automation: would b cool

```{r}
run_pipeline <- function(q_name, load_path, score_script, output_name) {
  source(load_path)
  data <- get(q_name)
  source("scripts/shared/01_merge_consent.R")
  source("scripts/shared/02_filter_data.R")
  source("scripts/shared/03_handle_missing.R")
  source(score_script)
  write.csv(data, paste0("outputs/", output_name, ".csv"), row.names = FALSE)
}

run_pipeline("BDI", "scripts/bdi/00_load.R", "scripts/bdi/04_score_bdi.R", "bdi_f")
run_pipeline("ATQ", "scripts/atq/00_load.R", "scripts/atq/04_score_atq.R", "atq_f")
```