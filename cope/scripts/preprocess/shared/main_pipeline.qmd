
---
title: "Preprocessing Pipeline"
format: html
execute:
  echo: true
---

```{r setup}
source("preprocess/shared/path.r") #data_dir
source("preprocess/shared/utilities.r") #small helpers
source("preprocess/shared/00_consent.R") # load_consent()
source("preprocess/shared/01_filter.r") # filter_clinical_data()
source("preprocess/shared/02_data_types.r") # data_types(), check_types()
```

```{r}
consent <- load_consent()
qes <- c("ATQ", "BAI", "BDI", "IIP", "MCQ", "PSWQ", "REGT", "SCL") #regp not a part yet 

run_pipeline <- function(q_name, load_path) {
  source(load_path)
  data <- get(q_name)
  data <- suppressMessages(
    suppressWarnings(
     filter_clinical_data(data, consent_df = consent)
    )
  )
  data <- data_types(data)

  print(summary(data)) 
  invisible(data)                         # return silently
}
```

```{r}
# Run two manually
atq_clean <- run_pipeline("ATQ", "preprocess/atq.r")
regt_clean <- run_pipeline("REGT", "preprocess/regt.r")
```

```{r}
# Or loop through all
all_data <- lapply(qes, function(q) {
  run_pipeline(q, paste0("preprocess/", tolower(q), ".r"))
})
names(all_data) <- qes
```
